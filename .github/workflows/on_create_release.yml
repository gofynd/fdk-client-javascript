on:
  release:
    types: [created]

jobs:

  publish-npm:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: 16
          registry-url: https://registry.npmjs.org/
      - uses: jaywcjlove/github-action-package@main
        with:
          version: ${{ github.ref_name }}
          rename: "@gofynd/fdk-client-javascript"
      - run: npm ci
      - run: npm publish --access public
        env:
          NODE_AUTH_TOKEN: ${{secrets.NPM_AUTH_TOKEN}}


  create-release:
    runs-on: ubuntu-latest

    steps:
      - name: checkout repository
        uses: actions/checkout@v3


      - name: create release on `@gofynd/fdk-client-python` repository
        run: |
          curl -L \
          -X POST \
          -H "Accept: application/vnd.github+json" \
          -H "Authorization: Bearer ${{ secrets.GH_ACCESS_TOKEN }}" \
          -H "X-GitHub-Api-Version: 2022-11-28" \
          https://api.github.com/repos/gofynd/fdk-client-python/releases \
          -d '{"tag_name":"${{ github.event.release.tag_name }}","target_commitish":"${{ github.event.release.target_commitish }}","name":"${{ github.event.release.name }}","draft":${{ github.event.release.draft }},"prerelease":${{ github.event.release.prerelease }},"generate_release_notes":true}'
        continue-on-error: true


      - name: create release on `@gofynd/fdk-client-java` repository
        run: |
          curl -L \
          -X POST \
          -H "Accept: application/vnd.github+json" \
          -H "Authorization: Bearer ${{ secrets.GH_ACCESS_TOKEN }}" \
          -H "X-GitHub-Api-Version: 2022-11-28" \
          https://api.github.com/repos/gofynd/fdk-client-java/releases \
          -d '{"tag_name":"${{ github.event.release.tag_name }}","target_commitish":"${{ github.event.release.target_commitish }}","name":"${{ github.event.release.name }}","draft":${{ github.event.release.draft }},"prerelease":${{ github.event.release.prerelease }},"generate_release_notes":true}'
        continue-on-error: true
      
          
      - name: create release on `@gofynd/fdk-client-swift` repository
        run: |
          curl -L \
          -X POST \
          -H "Accept: application/vnd.github+json" \
          -H "Authorization: Bearer ${{ secrets.GH_ACCESS_TOKEN }}" \
          -H "X-GitHub-Api-Version: 2022-11-28" \
          https://api.github.com/repos/gofynd/fdk-client-swift/releases \
          -d '{"tag_name":"${{ github.event.release.tag_name }}","target_commitish":"${{ github.event.release.target_commitish }}","name":"${{ github.event.release.name }}","draft":${{ github.event.release.draft }},"prerelease":${{ github.event.release.prerelease }},"generate_release_notes":true}'
        continue-on-error: true


      - name: create release on `@gofynd/fdk-client-kotlin` repository
        run: |
          curl -L \
          -X POST \
          -H "Accept: application/vnd.github+json" \
          -H "Authorization: Bearer ${{ secrets.GH_ACCESS_TOKEN }}" \
          -H "X-GitHub-Api-Version: 2022-11-28" \
          https://api.github.com/repos/gofynd/fdk-client-kotlin/releases \
          -d '{"tag_name":"${{ github.event.release.tag_name }}","target_commitish":"${{ github.event.release.target_commitish }}","name":"${{ github.event.release.name }}","draft":${{ github.event.release.draft }},"prerelease":${{ github.event.release.prerelease }},"generate_release_notes":true}'
        continue-on-error: true


      - name: create release on `@gofynd/fdk-client-golang` repository
        run: |
          curl -L \
          -X POST \
          -H "Accept: application/vnd.github+json" \
          -H "Authorization: Bearer ${{ secrets.GH_ACCESS_TOKEN }}" \
          -H "X-GitHub-Api-Version: 2022-11-28" \
          https://api.github.com/repos/gofynd/fdk-client-golang/releases \
          -d '{"tag_name":"${{ github.event.release.tag_name }}","target_commitish":"${{ github.event.release.target_commitish }}","name":"${{ github.event.release.name }}","draft":${{ github.event.release.draft }},"prerelease":${{ github.event.release.prerelease }},"generate_release_notes":true}'
        continue-on-error: true


      - name: create release on `@gofynd/fdk-client-apispec` repository
        run: |
          curl -L \
          -X POST \
          -H "Accept: application/vnd.github+json" \
          -H "Authorization: Bearer ${{ secrets.GH_ACCESS_TOKEN }}" \
          -H "X-GitHub-Api-Version: 2022-11-28" \
          https://api.github.com/repos/gofynd/fdk-client-apispec/releases \
          -d '{"tag_name":"${{ github.event.release.tag_name }}","target_commitish":"${{ github.event.release.target_commitish }}","name":"${{ github.event.release.name }}","draft":${{ github.event.release.draft }},"prerelease":${{ github.event.release.prerelease }},"generate_release_notes":true}'
        continue-on-error: true


      - name: create release on `@gofynd/fdk-client-documentation` repository
        run: |
            curl --header 'Content-Type: application/json' \
            --header "PRIVATE-TOKEN: ${{ secrets.GL_ACCESS_TOKEN }}" \
            --data '{ "name": "${{ github.event.release.name }}", "tag_name": "${{ github.event.release.tag_name }}", "ref": "${{ github.event.release.target_commitish }}" }' \
            --request POST "https://gitlab.com/api/v4/projects/30067193/releases"
